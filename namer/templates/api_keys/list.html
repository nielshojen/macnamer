{% extends "base.html" %}
{% load i18n %}

{% block script %}
<script type="text/javascript" charset="utf-8">
    $(document).ready(function() {
        $('.groupList').dataTable({
            "sDom": "<'row'<'span6'l><'span6'f>r>t<'row'<'span6'i><'span6'p>>",
            "iDisplayLength": 20,
            "aLengthMenu": [[20, 50, -1], [20, 50, "All"]],
            "sPaginationType": "bootstrap",
            "bStateSave": true,
            "aaSorting": [[1,'asc']]
        });
    } );
</script>

{% endblock %}

{% block nav %}
<li><a href="{% url 'api_keys_create' %}">New API Key</a></li>
{% endblock %}

{% block content %}

  <h1>API Keys</h1>

  {% if messages %}{% for m in messages %}<p>{{ m }}</p>{% endfor %}{% endif %}

  <table class="groupList table table-striped table-condensed">
    <thead>
        <tr>
            <th>Name</th>
            <th>Created</th>
            <th>Expires</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>

    {% for k in keys %}
      <tr>
        <td>{{ k.name }}</td>
        <td>{{ k.created }}</td>
        <td>{{ k.expires_at|default:"â€”" }}</td>
        <td>{% if k.revoked %}Revoked{% else %}Active{% endif %}</td>
        <td>
          {% if not k.revoked %}
            <form method="post" action="{% url 'api_keys_revoke' k.pk %}" style="display:inline">
              {% csrf_token %}
              <button type="submit" class="btn primary">Revoke</button>
            </form>
          {% else %}
            <form method="post" action="{% url 'api_keys_delete' k.prefix %}" style="display:inline"
                    onsubmit="return confirm('Really delete this API key? This cannot be undone.')">
                {% csrf_token %}<button type="submit" class="btn primary">Delete</button>
            </form>
          {% endif %}
        </td>
      </tr>
    {% empty %}
      <tr><td colspan="5">No API keys yet.</td></tr>
    {% endfor %}
  </table>
{% endblock %}